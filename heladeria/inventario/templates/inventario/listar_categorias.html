{% extends "base.html" %}
{% block title %}Categorías{% endblock %}
{% block content %}
<div class="container mt-3">
  <h3>Categorías</h3>

  {% if not read_only %}
    <a href="{% url 'inventario:crear_categoria' %}" class="btn btn-primary mb-3">➕ Nueva Categoría</a>
  {% endif %}

  <div class="d-flex justify-content-between align-items-center mb-3">
    <form method="get" id="filterForm" class="d-flex gap-2">
      <input type="text" name="q" value="{{ q }}" placeholder="Buscar..." class="form-control">
      <select name="order" class="form-select">
        <option value="asc" {% if order == 'asc' %}selected{% endif %}>A-Z</option>
        <option value="desc" {% if order == 'desc' %}selected{% endif %}>Z-A</option>
      </select>
      <select name="per_page" class="form-select">
        <option value="5" {% if per_page == 5 %}selected{% endif %}>5</option>
        <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
        <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
      </select>
      <button type="submit" class="btn btn-secondary">Filtrar</button>
    </form>
  </div>

  <div id="resultados">
    {% include 'inventario/partials/categorias_results.html' %}
  </div>
</div>

<script>
document.getElementById("filterForm").addEventListener("input", function(e) {
  const form = e.currentTarget;
  const params = new URLSearchParams(new FormData(form)).toString();
  fetch("?" + params, {headers: {"X-Requested-With": "XMLHttpRequest"}})
    .then(res => res.text())
    .then(html => {
      document.getElementById("resultados").innerHTML = html;
    });
});
</script>
{% endblock %}
