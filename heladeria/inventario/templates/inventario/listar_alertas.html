{% extends "base.html" %}
{% load static %}
{% block title %}{{ titulo }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <h3 class="mb-4">{{ titulo }}</h3>

    <div class="d-flex justify-content-between align-items-center mb-3">
        
        {# Botón (Opcional, si permites crear alertas manualmente) #}
        {% if not read_only %}
            <a href="{% url 'inventario:crear_alerta' %}" class="btn btn-primary">
                <i class="bi bi-plus-lg"></i> Nueva Alerta
            </a>
        {% endif %}
    </div>

    {# INICIO DEL FORMULARIO DE BÚSQUEDA Y FILTROS #}
    <form id="filters-form" class="row g-2 mb-3" method="get">
        
        {# CAMPO DE BÚSQUEDA Y BOTÓN APLICAR #}
        <div class="col-md-4">
            <div class="input-group">
                <input type="search"
                        name="q"
                        id="q-input"
                        class="form-control"
                        placeholder="Buscar por insumo, tipo o mensaje..."
                        value="{{ q|default:'' }}">
                
                <button type="submit" class="btn btn-primary" id="apply-filter-btn">
                    <i class="bi bi-search"></i> Aplicar
                </button>
            </div>
        </div>

        {# SELECT DE ORDENAR POR (Puedes añadir más opciones si lo necesitas) #}
        <div class="col-md-3">
            <div class="input-group">
                <span class="input-group-text">Ordenar por</span>
                <select name="sort" id="sort-select" class="form-select">
                    <option value="fecha"     {% if sort == 'fecha' %}selected{% endif %}>Fecha</option>
                    <option value="insumo"    {% if sort == 'insumo' %}selected{% endif %}>Insumo</option>
                    <option value="tipo"      {% if sort == 'tipo' %}selected{% endif %}>Tipo</option>
                </select>
            </div>
        </div>

        {# SELECT DE ORDEN #}
        <div class="col-md-2">
            <select name="order" id="order-select" class="form-select">
                <option value="asc"  {% if order != 'desc' %}selected{% endif %}>Ascendente</option>
                <option value="desc" {% if order == 'desc' %}selected{% endif %}>Descendente</option>
            </select>
        </div>

        {# SELECT DE ELEMENTOS POR PÁGINA #}
        <div class="col-md-2">
            <select name="per_page" id="per-page-select" class="form-select">
                <option value="10"  {% if per_page == 10 %}selected{% endif %}>10 por página</option>
                <option value="20"  {% if per_page == 20 %}selected{% endif %}>20 por página</option>
                <option value="25"  {% if per_page == 25 %}selected{% endif %}>25 por página</option>
                <option value="50"  {% if per_page == 50 %}selected{% endif %}>50 por página</option>
            </select>
        </div>
        
        {# NUEVO: FILTRO MOSTRAR INACTIVAS (CHECKBOX) #}
        <div class="col-md-1 d-flex align-items-center justify-content-end">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="mostrarInactivasSwitch"
                    name="mostrar_inactivas" value="1" 
                    {% if mostrar_inactivas %}checked{% endif %}
                    onchange="document.getElementById('filters-form').submit();">
                <label class="form-check-label" for="mostrarInactivasSwitch" title="Mostrar alertas marcadas como revisadas/inactivas.">
                    Historial
                </label>
            </div>
        </div>
        
        {# El hidden field mostrar_inactivas ya no es necesario aquí, la lógica la lleva el switch o se omite si está desmarcado. #}
        {# Necesitamos el hidden de página para que no vuelva a la página 1 cuando se usan los filtros de arriba #}
        <input type="hidden" name="page" id="page-input" value="{{ alertas.number }}">
    </form>
    {# FIN DEL FORMULARIO #}

    <div id="results">
        {% include "inventario/partials/alertas_results.html" %}
    </div>

</div>
{% endblock %}

{% block extra_js %}
{# Se asume que el script AJAX ya está en tu base.html o en un partial de JS #}
{# Si necesitas el script completo para filtros, puedes usar el del listar_insumos #}
{% endblock %}